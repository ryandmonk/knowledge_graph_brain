# Retail Schema Example
kb_id: retail-demo
embedding:
  provider: "ollama:mxbai-embed-large"
  chunking:
    strategy: "by_fields"
    fields: ["description", "attributes"]
schema:
  nodes:
    - label: Product
      key: sku
      props: [sku, name, description, category, price]
    - label: Order
      key: order_id
      props: [order_id, order_date, total, currency]
    - label: Customer
      key: email
      props: [email, name, segment]
  relationships:
    - type: CONTAINS
      from: Order
      to: Product
      props: [qty, unit_price]
    - type: PURCHASED_BY
      from: Order
      to: Customer
mappings:
  sources:
    - source_id: "products"
      connector_url: "http://localhost:8081/data/products"
      document_type: "product"
      extract:
        node: Product
        assign:
          sku: "$.sku"
          name: "$.name"
          description: "$.description"
          category: "$.category"
          price: "$.price"
      edges: []
    
    - source_id: "customers"
      connector_url: "http://localhost:8081/data/customers"
      document_type: "customer"
      extract:
        node: Customer
        assign:
          email: "$.email"
          name: "$.name"
          segment: "$.segment"
      edges: []
    
    - source_id: "shopify"
      document_type: "order"
      extract:
        node: Order
        assign:
          order_id: "$.id"
          order_date: "$.created_at"
          total: "$.total_price"
          currency: "$.currency"
      edges:
        - type: CONTAINS
          from: { node: Order, key: "$.id" }
          to: 
            node: Product
            key: "$.line_items[*].sku"
            props:
              qty: "$.line_items[*].quantity"
              unit_price: "$.line_items[*].price"
        - type: PURCHASED_BY
          from: { node: Order, key: "$.id" }
          to: { node: Customer, key: "$.customer.email" }