kb_id: confluence-demo
embedding:
  provider: "ollama:mxbai-embed-large"
  chunking:
    strategy: "by_headings"
    max_tokens: 1200
schema:
  nodes:
    - label: Document
      key: page_id
      props: [title, url, space, created, updated, content]
    - label: Person
      key: email
      props: [name, email]
    - label: Topic
      key: name
      props: [name]
  relationships:
    - type: AUTHORED_BY
      from: Document
      to: Person
    - type: DISCUSSES
      from: Document
      to: Topic
mappings:
  sources:
    - source_id: "confluence"
      document_type: "page"
      extract:
        node: Document
        assign:
          page_id: "$.id"
          title: "$.title"
          url: "$._links.webui"
          space: "$.space.key"
          created: "$.history.createdDate"
          updated: "$.history.lastUpdated.when"
          content: "$.body.storage.value"
      edges:
        - type: AUTHORED_BY
          from:
            node: Document
            key: "$.id"
          to:
            node: Person
            key: "$.history.createdBy.email"
            assign:
              name: "$.history.createdBy.displayName"
              email: "$.history.createdBy.email"
      extract:
        node: Document
        assign:
          page_id: "$.id"
          title: "$.title"
          url:   "$._links.webui"
          space: "$.space.key"
          created: "$.history.createdDate"
          updated: "$.history.lastUpdated.when"
          content: "$.body.storage.value"
      edges:
        - type: AUTHORED_BY
          from: { node: Document, key: "$.id" }
          to:
            node: Person
            key: "$.history.createdBy.email"
            props:
              name: "$.history.createdBy.displayName"
        - type: DISCUSSES
          from: { node: Document, key: "$.id" }
          to:
            node: Topic
            key: "$.labels[*].name"
```